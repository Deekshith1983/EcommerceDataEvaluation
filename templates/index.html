<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Commerce Analytics Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
            text-align: center;
        }

        h1 {
            color: #1f4788;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #1f4788;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-size: 1em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            min-height: 450px;
            overflow: hidden;
            position: relative;
        }

        .chart-card.full-width {
            grid-column: 1 / -1;
        }

        .chart-container {
            width: 100%;
            height: 400px;
            position: relative;
            overflow: hidden;
        }

        .loading {
            text-align: center;
            padding: 50px;
            color: #666;
        }

        footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            padding: 20px;
        }

        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>ðŸ“Š E-Commerce Analytics Dashboard</h1>
            <p class="subtitle">Real-time insights from your business data</p>
        </header>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value">{{ stats.total_records }}</div>
                <div class="stat-label">Total Records</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ stats.total_customers }}</div>
                <div class="stat-label">Customers</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ stats.total_orders }}</div>
                <div class="stat-label">Orders</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">{{ stats.total_products }}</div>
                <div class="stat-label">Products</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">â‚¹{{ '{:,.0f}'.format(stats.total_revenue) }}</div>
                <div class="stat-label">Total Revenue</div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-card">
                <div id="shipping-status-chart" class="chart-container"></div>
            </div>
            <div class="chart-card">
                <div id="payment-methods-chart" class="chart-container"></div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-card full-width">
                <div id="top-products-chart" class="chart-container"></div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-card">
                <div id="category-sales-chart" class="chart-container"></div>
            </div>
            <div class="chart-card">
                <div id="city-orders-chart" class="chart-container"></div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-card full-width">
                <div id="courier-performance-chart" class="chart-container"></div>
            </div>
        </div>

        <footer>
            <p>ðŸš€ E-Commerce Data Analytics | Built with Flask & Plotly</p>
        </footer>
    </div>

    <script>
        // Configuration for all charts - enable hover but no toolbar
        const config = {
            responsive: true,
            displayModeBar: false,
            staticPlot: false,
            scrollZoom: false
        };

        const layout_config = {
            autosize: true,
            margin: { t: 50, r: 30, b: 50, l: 50 }
        };

        // Load all charts
        async function loadCharts() {
            try {
                // Shipping Status
                const shippingResponse = await fetch('/api/shipping_status');
                const shippingData = await shippingResponse.json();
                const shippingFig = JSON.parse(shippingData);
                shippingFig.layout = { ...shippingFig.layout, ...layout_config, height: 380, width: null };
                Plotly.newPlot('shipping-status-chart', shippingFig.data, shippingFig.layout, config);

                // Payment Methods
                const paymentResponse = await fetch('/api/payment_methods');
                const paymentData = await paymentResponse.json();
                const paymentFig = JSON.parse(paymentData);
                paymentFig.layout = { ...paymentFig.layout, ...layout_config, height: 380, width: null };
                Plotly.newPlot('payment-methods-chart', paymentFig.data, paymentFig.layout, config);

                // Top Products
                const productsResponse = await fetch('/api/top_products');
                const productsData = await productsResponse.json();
                const productsFig = JSON.parse(productsData);
                productsFig.layout = { ...productsFig.layout, ...layout_config, height: 380, width: null };
                Plotly.newPlot('top-products-chart', productsFig.data, productsFig.layout, config);

                // Category Sales
                const categoryResponse = await fetch('/api/category_sales');
                const categoryData = await categoryResponse.json();
                const categoryFig = JSON.parse(categoryData);
                categoryFig.layout = { ...categoryFig.layout, ...layout_config, height: 380, width: null };
                Plotly.newPlot('category-sales-chart', categoryFig.data, categoryFig.layout, config);

                // City Orders
                const cityResponse = await fetch('/api/city_orders');
                const cityData = await cityResponse.json();
                const cityFig = JSON.parse(cityData);
                cityFig.layout = { ...cityFig.layout, ...layout_config, height: 380, width: null };
                Plotly.newPlot('city-orders-chart', cityFig.data, cityFig.layout, config);

                // Courier Performance
                const courierResponse = await fetch('/api/courier_performance');
                const courierData = await courierResponse.json();
                const courierFig = JSON.parse(courierData);
                courierFig.layout = { ...courierFig.layout, ...layout_config, height: 380, width: null };
                Plotly.newPlot('courier-performance-chart', courierFig.data, courierFig.layout, config);

                console.log('All charts loaded successfully!');
            } catch (error) {
                console.error('Error loading charts:', error);
            }
        }

        // Load charts when page loads
        window.addEventListener('load', loadCharts);

        // Resize charts on window resize
        window.addEventListener('resize', function () {
            Plotly.Plots.resize('shipping-status-chart');
            Plotly.Plots.resize('payment-methods-chart');
            Plotly.Plots.resize('top-products-chart');
            Plotly.Plots.resize('category-sales-chart');
            Plotly.Plots.resize('city-orders-chart');
            Plotly.Plots.resize('courier-performance-chart');
        });
    </script>
</body>

</html>